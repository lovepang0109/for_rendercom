import{D as m,_ as C}from"./DialogBox.c4d55d6b.js";import{y as R,E as b,r as p,o as f,c as g,p as s,w as r,R as v,b as T,bl as P,bR as w,D,P as _,bM as W,m as l,F as E,a as H,x as c,ba as I}from"./index.84400ea8.js";import{o as M}from"./main.9984b416.js";import{n as G}from"./index.c0fab4f2.js";import{d as h,V,c as u}from"./VRow.5bc57025.js";import{V as L}from"./VAutocomplete.f4bce551.js";import"./VDialog.e12e96f6.js";const{mapGetters:N,mapActions:U,mapState:$}=b("dashboard"),j={components:{DialogBox:m,DashboardNotify:C,VueDatePicker:M},data(){return{isBox:!1,filterPeriod:"Day",picker:"",headers:[{title:"Period",align:"start",key:"Period"},{title:"ServiceID",align:"start",key:"ServiceID"},{title:"Service",align:"start",key:"Service"},{title:"Host Name",align:"start",key:"Host"},{title:"Price",align:"start",key:"Price"},{title:"Total Cosmote Sent",align:"start",key:"TotalCosmote_Sent"},{title:"Total Vodafone Sent",align:"start",key:"TotalVodafone_Sent"},{title:"Total Wind Sent",align:"start",key:"TotalWind_Sent"},{title:"Total Cosmote Receive",align:"start",key:"TotalCosmote_Receive"},{title:"Total Vodafone Receive",align:"start",key:"TotalVodafone_Receive"},{title:"Total Wind Receive",align:"start",key:"TotalWind_Receive"},{title:"Total Cosmote Billed",align:"start",key:"TotalCosmote_Billed"},{title:"Total Vodafone Billed",align:"start",key:"TotalVodafone_Billed"},{title:"Total Wind Billed",align:"start",key:"TotalWind_Billed"},{title:"Total Cosmote Eur",align:"start",key:"TotalCosmote_Eur"},{title:"Total Vodafone Eur",align:"start",key:"TotalVodafone_Eur"},{title:"Total Wind Eurr",align:"start",key:"TotalWind_Eur"}],filterHost:null}},computed:{...N(["GetBilling","GetServiceData","IsLoading"]),getBilling:function(){var o,a,n,i;return(a=(o=this.GetBilling)==null?void 0:o.tMtBilling)!=null&&a.tMtBillingRow?(i=(n=this.GetBilling)==null?void 0:n.tMtBilling)==null?void 0:i.tMtBillingRow.map(t=>{let d={};return d=t,d.Service=decodeURIComponent(t==null?void 0:t.Service),d}):[]},svcList:function(){var a,n;let o={};return(n=(a=this.GetServiceData)==null?void 0:a.tService)==null||n.tServiceRow.forEach(i=>{o[decodeURIComponent(i.Service)]=i.ServiceID}),o},hsLists:function(){var o,a;return(a=(o=this.GetServiceData)==null?void 0:o.tService)==null?void 0:a.tServiceRow.map(n=>n.Host)},billOption:function(){let o=this.getBilling.reduce((i,t)=>i=i+((t==null?void 0:t.TotalCosmote_Sent)+(t==null?void 0:t.TotalVodafone_Sent)+(t==null?void 0:t.TotalWind_Sent)),0),a=this.getBilling.reduce((i,t)=>i=i+((t==null?void 0:t.TotalCosmote_Receive)+(t==null?void 0:t.TotalVodafone_Receive)+(t==null?void 0:t.TotalWind_Receive)),0),n=this.getBilling.reduce((i,t)=>i=i+((t==null?void 0:t.TotalCosmote_Billed)+(t==null?void 0:t.TotalVodafone_Billed)+(t==null?void 0:t.TotalWind_Billed)),0);return{tooltip:{},legend:{orient:"horizontal",top:"top",textStyle:{color:"#ccc"}},series:[{type:"pie",data:[{value:o,name:"Total Sent"},{value:a,name:"Total Receive"},{value:n,name:"Total Billed"}]}]}},periodPicker:function(){return this.filterPeriod=="Month"}},mounted(){this.fetchServiceData();const o=new Date,a=new Date(new Date().setDate(o.getDate()-7));this.picker=[a,o],this.fetchBillingData({period:this.filterPeriod,range:`${this.formatDate(a)}#${this.formatDate(o)}`})},methods:{...U(["fetchBillingData","fetchServiceData"]),formatDate(o){var a=new Date(o),n=""+(a.getMonth()+1),i=""+a.getDate(),t=a.getFullYear();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),[i,n,t].join("-")},formatMonth(o){var a=new Date(o);if(a!="Invalid Date"){let n=""+(a.getMonth()+1),i=a.getFullYear();return n.length<2&&(n="0"+n),[n,i].join("-")}else{let n=""+((o==null?void 0:o.month)+1),i=o==null?void 0:o.year;return n.length<2&&(n="0"+n),[n,i].join("-")}},billingSearch(){if(!this.picker){G("Please select the date range","error");return}let o=this.picker[0],a=this.picker[1];this.filterPeriod=="Day"?this.fetchBillingData({period:this.filterPeriod,range:`${this.formatDate(o)}#${this.formatDate(a)}`,host:this.filterHost?this.filterHost.join(","):""}):this.fetchBillingData({period:this.filterPeriod,range:`${this.formatMonth(o)}#${this.formatMonth(a)}`,host:this.filterHost?this.filterHost.join(","):""})},Reset(){this.filterHost=null,this.filterPeriod="Day";const o=new Date,a=new Date(new Date().setDate(o.getDate()-7));this.picker=[a,o]}},watch:{}},z={key:1,class:"px-4 py-4",style:{"min-height":"400px"}},F=l("thead",{class:"text-center"},[l("tr",null,[l("th",{scope:"col",class:"text-center"},"Period"),l("th",{scope:"col",class:"text-center"},"ServiceID"),l("th",{scope:"col",class:"text-center"},"Service"),l("th",{scope:"col",class:"text-center"},"Host"),l("th",{scope:"col",class:"text-center"},"Price"),l("th",{scope:"col",class:"text-center"},"Cosmote Sent"),l("th",{scope:"col",class:"text-center"},"Vodafone Sent"),l("th",{scope:"col",class:"text-center"},"Wind Sent"),l("th",{scope:"col",class:"text-center"},"Cosmote Receive"),l("th",{scope:"col",class:"text-center"},"Vodafone Receive"),l("th",{scope:"col",class:"text-center"},"Wind Receive"),l("th",{scope:"col",class:"text-center"},"Cosmote Billed"),l("th",{scope:"col",class:"text-center"},"Vodafone Billed"),l("th",{scope:"col",class:"text-center"},"Wind Billed"),l("th",{scope:"col",class:"text-center"},"Cosmote Eur"),l("th",{scope:"col",class:"text-center"},"Vodafone Eur"),l("th",{scope:"col",class:"text-center"},"Wind Eur")])],-1),A={class:"text-center"};function O(o,a,n,i,t,d){const k=p("VueDatePicker"),B=p("download-excel"),y=p("v-chart"),S=p("DialogBox");return f(),g("div",null,[s(u,{class:"match-height"},{default:r(()=>[s(h,{cols:"12",md:"12",lg:"12"},{default:r(()=>[s(V,{class:"text-center py-4",title:"Billing Data"},{default:r(()=>[s(v),o.IsLoading?(f(),T(P,{key:0,size:50,color:"primary",indeterminate:""})):(f(),g("div",z,[s(u,{class:"align-center"},{default:r(()=>[s(h,{cols:"12",md:"3",sm:"6"},{default:r(()=>[s(L,{clearable:"",multiple:"",label:"Host",items:d.hsLists,modelValue:t.filterHost,"onUpdate:modelValue":a[0]||(a[0]=e=>t.filterHost=e)},null,8,["items","modelValue"])]),_:1}),s(h,{cols:"12",md:"2",sm:"6"},{default:r(()=>[s(w,{label:"Period",items:["Day","Month"],modelValue:t.filterPeriod,"onUpdate:modelValue":a[1]||(a[1]=e=>t.filterPeriod=e)},null,8,["modelValue"])]),_:1}),s(h,{cols:"12",md:"3",sm:"6"},{default:r(()=>[s(k,{modelValue:t.picker,"onUpdate:modelValue":a[2]||(a[2]=e=>t.picker=e),range:"","enable-time-picker":!1,"month-picker":d.periodPicker},null,8,["modelValue","month-picker"])]),_:1}),s(h,{cols:"12",md:"4",sm:"6",class:"text-center"},{default:r(()=>[s(D,{onClick:d.billingSearch,color:"info",dark:"",class:"btn border",size:"small","prepend-icon":"tabler-search"},{default:r(()=>[_(" Search ")]),_:1},8,["onClick"]),s(D,{color:"secondary",dark:"",class:"btn border ml-4",size:"small","prepend-icon":"tabler-refresh",onClick:d.Reset},{default:r(()=>[_(" Reset ")]),_:1},8,["onClick"]),s(B,{data:d.getBilling,class:"d-inline"},{default:r(()=>[s(D,{color:"success",dark:"",class:"btn border ml-4",size:"small","prepend-icon":"mdi-file-excel"},{default:r(()=>[_(" Excel ")]),_:1})]),_:1},8,["data"])]),_:1}),s(h,{cols:"12",md:"3",sm:"12"})]),_:1}),s(W,{class:"text-no-wrap text-center py-4"},{default:r(()=>[F,l("tbody",A,[(f(!0),g(E,null,H(d.getBilling,(e,x)=>(f(),g("tr",{style:{height:"3.75rem"},key:x},[l("td",null,c(e==null?void 0:e.Period),1),l("td",null,c(e==null?void 0:e.ServiceID),1),l("td",null,c(decodeURIComponent(e==null?void 0:e.Service)),1),l("td",null,c(e==null?void 0:e.Host),1),l("td",null,c(e==null?void 0:e.Price),1),l("td",null,c(e==null?void 0:e.TotalCosmote_Sent),1),l("td",null,c(e==null?void 0:e.TotalVodafone_Sent),1),l("td",null,c(e==null?void 0:e.TotalWind_Sent),1),l("td",null,c(e==null?void 0:e.TotalCosmote_Receive),1),l("td",null,c(e==null?void 0:e.TotalVodafone_Receive),1),l("td",null,c(e==null?void 0:e.TotalWind_Receive),1),l("td",null,c(e==null?void 0:e.TotalCosmote_Billed),1),l("td",null,c(e==null?void 0:e.TotalVodafone_Billed),1),l("td",null,c(e==null?void 0:e.TotalWind_Billed),1),l("td",null,c(e==null?void 0:e.TotalCosmote_Eur),1),l("td",null,c(e==null?void 0:e.TotalVodafone_Eur),1),l("td",null,c(e==null?void 0:e.TotalWind_Eur),1)]))),128))])]),_:1}),s(v),s(u,{class:"align-left pt-4"},{default:r(()=>[s(h,{cols:"12",md:"6",sm:"6"}),s(h,{cols:"12",md:"6",sm:"6",class:"text-right pr-4"},{default:r(()=>[_(" Total Rows: "+c(d.getBilling.length),1)]),_:1})]),_:1})]))]),_:1})]),_:1})]),_:1}),s(u,{class:"match-height"},{default:r(()=>[s(h,{cols:"12",md:"12",lg:"12"},{default:r(()=>[s(V,{class:"text-center",title:"Billing Insight"},{default:r(()=>[o.IsLoading?I("",!0):(f(),T(y,{key:0,class:"chart",option:d.billOption},null,8,["option"]))]),_:1})]),_:1})]),_:1}),s(S,{isVisable:t.isBox},null,8,["isVisable"])])}const ee=R(j,[["render",O]]);export{ee as default};
